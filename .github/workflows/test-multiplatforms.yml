name: Test Multi-Platforms

on:
  push:
    branches: [ main, cpack-builds ]
  pull_request:
    branches: [ main,  ]
  workflow_dispatch:

jobs:
  build-artifacts:
    runs-on: ubuntu-latest
   
    steps:
    - uses: actions/checkout@v4
    
    - name: Install dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y \
           build-essential cmake \
           gcc-mingw-w64-x86-64 \
           binutils-mingw-w64-x86-64 \
           mingw-w64-common \
           nsis \
           
    - name: Build Linux release
      run: make -C test build-pug
    
    - name: Build Windows release
      run: make -C test build-win
    
    - name: Package releases
      run: |
        # Create release packages
        mkdir -p releases
        
        # Linux package
        cd build-linux
        tar -czf ../releases/pug-linux-x64.tar.gz bin/pug bin/langlevels
        cd ..
        
        # Windows package
        cd build-windows
        zip -r ../releases/pug-windows-x64.zip bin/pug.exe bin/langlevels
        cd ..
    
    - name: Upload release artifacts
      uses: actions/upload-artifact@v4
      with:
        name: pug-releases
        path: releases/
